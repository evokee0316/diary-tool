<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ½é‡ç®¡ç† & å†å²è¿½è¸ª</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #1d1d1f;
            --border-radius: 12px;
            --success-color: #34C759;
            --danger-color: #FF3B30;
            --secondary-text: #86868b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
            line-height: 1.5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* é¡¶éƒ¨å¯¼èˆª Tab */
        .nav-tabs {
            display: flex;
            background: #e3e3e8;
            padding: 4px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 9px;
            font-weight: 600;
            font-size: 0.95rem;
            color: #666;
            transition: all 0.2s;
        }

        .nav-tab.active {
            background: #fff;
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* é¡µé¢åˆ‡æ¢é€»è¾‘ */
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-display {
            font-weight: bold;
            color: var(--secondary-text);
        }

        select, .time-input {
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .time-input {
            background: #e8e8ed;
            width: 110px;
            text-align: center;
            font-weight: 600;
            border: none;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .phase-name {
            font-weight: bold;
            color: var(--primary-color);
        }

        .action-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-btn {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .checkbox-btn.checked {
            background-color: #e8fce8;
            border-color: var(--success-color);
            color: #006400;
        }

        .checkbox-btn input { margin-right: 10px; transform: scale(1.2); }

        .input-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 16px;
        }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-danger { background: transparent; color: var(--danger-color); border: 1px solid var(--danger-color); }

        /* å†å²è®°å½•æ ·å¼ */
        .month-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 25px 0 10px 5px;
            color: #333;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 5px solid #ddd;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .history-item:hover { background: #fafafa; }

        .history-item.status-good { border-left-color: var(--success-color); }
        .history-item.status-mid { border-left-color: #FFD60A; }
        .history-item.status-bad { border-left-color: var(--danger-color); }

        .history-date { font-weight: bold; font-size: 1.05rem; }
        .history-summary { color: #666; font-size: 0.9rem; margin-top: 5px; }
        .history-tags { display: flex; gap: 5px; margin-top: 8px; }
        .tag { font-size: 0.75rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #555; }

        /* æ¨¡æ€æ¡† (æŸ¥çœ‹è¯¦æƒ…) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; width: 90%; max-width: 500px; max-height: 80vh;
            border-radius: 16px; padding: 20px; overflow-y: auto; position: relative;
        }
        .modal-close {
            position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #999;
        }
        .report-text {
            white-space: pre-wrap; font-family: monospace; background: #f5f5f7; padding: 15px; border-radius: 8px; font-size: 0.9rem;
        }

        /* Toast */
        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed;
            z-index: 9999; left: 50%; bottom: 30px; transform: translateX(-50%);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

<div class="container">
    <!-- é¡¶éƒ¨ Tab å¯¼èˆª -->
    <div class="nav-tabs">
        <div class="nav-tab active" onclick="switchTab('checkin')">ğŸ“ ä»Šæ—¥æ‰“å¡</div>
        <div class="nav-tab" onclick="switchTab('history')">ğŸ“… å†å²è®°å½•</div>
    </div>

    <!-- é¡µé¢ 1: ä»Šæ—¥æ‰“å¡ -->
    <div id="page-checkin" class="page-section active">
        <div class="card status-bar">
            <span class="date-display" id="currentDate"></span>
            <select id="energyStatus" onchange="autoSave()">
                <option value="ğŸŸ¢ æ—ºç››">çŠ¶æ€: ğŸŸ¢ æ—ºç››</option>
                <option value="ğŸŸ¡ å¹³ç¨³" selected>çŠ¶æ€: ğŸŸ¡ å¹³ç¨³</option>
                <option value="ğŸ”´ ç–²æƒ«">çŠ¶æ€: ğŸ”´ ç–²æƒ«</option>
            </select>
        </div>

        <!-- 08:30 - 09:00 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_01" value="08:30 - 09:00" onchange="autoSave()">
                <span class="phase-name">ğŸŒ± å¯åŠ¨é˜¶æ®µ</span>
            </div>
            <div class="action-group">
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_water_am" onchange="autoSave()"> 200ml æ¸©æ°´å”¤é†’
                </label>
                <input type="text" class="input-field" id="input_breakfast" placeholder="ğŸ¥£ æ—©é¤åƒäº†ä»€ä¹ˆï¼Ÿ" oninput="autoSave()">
            </div>
        </div>

        <!-- 09:00 - 10:30 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_02" value="09:00 - 10:30" onchange="autoSave()">
                <span class="phase-name">ğŸ”¥ çˆ†ç ´é˜¶æ®µ</span>
            </div>
            <div class="action-group">
                <input type="text" class="input-field" id="input_top1_task" placeholder="ğŸ¯ è¾“å…¥ä»Šæ—¥ Top 1 æ ¸å¿ƒä»»åŠ¡" oninput="autoSave()">
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_focus_90" onchange="autoSave()"> ä¸“æ³¨90åˆ†é’Ÿè¾¾æˆ
                </label>
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_drink_supply" onchange="autoSave()"> æ…¢é¥®è¡¥ç»™å®Œæˆ
                </label>
            </div>
        </div>

        <!-- 10:30 - 12:00 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_03" value="10:30 - 12:00" onchange="autoSave()">
                <span class="phase-name">ğŸ”„ è°ƒèŠ‚é˜¶æ®µ</span>
            </div>
            <div class="action-group">
                <input type="text" class="input-field" id="input_rest_activity" placeholder="ğŸš¶ åšäº†ä»€ä¹ˆä¼‘æ¯æ´»åŠ¨ï¼Ÿ" oninput="autoSave()">
                <input type="text" class="input-field" id="input_task_2" placeholder="ğŸ“š ç¬¬äºŒä»»åŠ¡å†…å®¹" oninput="autoSave()">
            </div>
        </div>

        <!-- 12:00 - 13:30 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_04" value="12:00 - 13:30" onchange="autoSave()">
                <span class="phase-name">ğŸ§˜â€â™€ï¸ å…»å¿ƒåˆä¼‘</span>
            </div>
            <div class="action-group">
                <input type="text" class="input-field" id="input_lunch" placeholder="ğŸ¥— åˆé¤å†…å®¹" oninput="autoSave()">
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_nap" onchange="autoSave()"> é™å/åˆä¼‘å®Œæˆ
                </label>
            </div>
        </div>

        <!-- 13:30 - 17:30 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_05" value="13:30 - 17:30" onchange="autoSave()">
                <span class="phase-name">âš–ï¸ åˆ‡æ¢æ¨¡å¼</span>
            </div>
            <div class="action-group">
                <select id="afternoon_mode" class="input-field" style="margin-bottom: 10px;" onchange="autoSave()">
                    <option value="A. çˆ†ç ´æ¨¡å¼">å½“å‰æ¨¡å¼ï¼šA. çˆ†ç ´ (é«˜å¼ºåº¦)</option>
                    <option value="B. å†·å´æ¨¡å¼">å½“å‰æ¨¡å¼ï¼šB. å†·å´ (æ•´ç†/ç”»å›¾)</option>
                </select>
                <textarea class="input-field" id="input_pm_tasks" rows="3" placeholder="ğŸ“ ä¸‹åˆä»»åŠ¡æ¸…å•" oninput="autoSave()"></textarea>
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_snack" onchange="autoSave()"> ä¸‹åˆåŠ é¤ (æ°´æœ/åšæœ)
                </label>
            </div>
        </div>

        <!-- 17:30 - 19:00 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_06" value="17:30 - 19:00" onchange="autoSave()">
                <span class="phase-name">ğŸƒ é‡Šå‹é˜¶æ®µ</span>
            </div>
            <div class="action-group">
                <input type="text" class="input-field" id="input_exercise" placeholder="ğŸƒ è¿åŠ¨é¡¹ç›®" oninput="autoSave()">
                <input type="text" class="input-field" id="input_dinner" placeholder="ğŸ² æ™šé¤å†…å®¹" oninput="autoSave()">
            </div>
        </div>

        <!-- 20:30 - 22:30 -->
        <div class="card">
            <div class="card-header">
                <input type="text" class="time-input" id="time_07" value="20:30 - 22:30" onchange="autoSave()">
                <span class="phase-name">ğŸŒ™ ä¿®å¤é˜¶æ®µ</span>
            </div>
            <div class="action-group">
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_no_phone" onchange="autoSave()"> å±å¹•å®µç¦
                </label>
                <label class="checkbox-btn" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check_foot_bath" onchange="autoSave()"> çƒ­æ°´æ³¡è„š
                </label>
                <input type="text" class="input-field" id="input_audio" placeholder="ğŸ§ ç¡å‰éŸ³é¢‘/ä¹¦ç±" oninput="autoSave()">
            </div>
        </div>
        
        <!-- å¤ç›˜ -->
        <div class="card">
            <div class="card-header">
                <span class="phase-name">ğŸ’¡ æ¯æ—¥å¤ç›˜</span>
            </div>
            <textarea class="input-field" id="input_review" rows="3" placeholder="èº«ä½“æ„Ÿè§‰å¦‚ä½•ï¼Ÿä½•æ—¶æ•ˆç‡æœ€é«˜ï¼Ÿ" oninput="autoSave()"></textarea>
        </div>

        <div class="btn-group">
            <button class="btn btn-success" onclick="archiveToday()">âœ… å®Œæˆå¹¶å½’æ¡£ (ä¿å­˜ä»Šæ—¥)</button>
            <button class="btn btn-primary" onclick="generateAndCopy()">ğŸ“‹ ä»…å¤åˆ¶ä»Šæ—¥è®°å½•</button>
            <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºä»Šæ—¥é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <!-- é¡µé¢ 2: å†å²è®°å½• -->
    <div id="page-history" class="page-section">
        <div id="history-container">
            <!-- å†å²è®°å½•å°†é€šè¿‡ JS æ’å…¥è¿™é‡Œ -->
            <p style="text-align: center; color: #999; margin-top: 50px;">æš‚æ— å†å²è®°å½•ï¼Œè¯·åœ¨â€œä»Šæ—¥æ‰“å¡â€é¡µç‚¹å‡»â€œå®Œæˆå¹¶å½’æ¡£â€</p>
        </div>
    </div>

</div>

<!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal(event, true)">&times;</span>
        <h3 id="modalTitle">è®°å½•è¯¦æƒ…</h3>
        <div class="report-text" id="modalText"></div>
        <button class="btn btn-danger" id="deleteBtn" style="margin-top: 20px; width: 100%; padding: 10px;">åˆ é™¤æ­¤æ¡è®°å½•</button>
    </div>
</div>

<div id="toast">æ“ä½œæˆåŠŸï¼</div>

<script>
    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        // è®¾ç½®æ—¥æœŸ
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('zh-CN', dateOptions);
        
        // åŠ è½½ä»Šæ—¥æš‚å­˜
        loadSavedData();
        // åŠ è½½å†å²åˆ—è¡¨
        renderHistory();
    };

    // --- æ ‡ç­¾é¡µåˆ‡æ¢ ---
    function switchTab(tabName) {
        // åˆ‡æ¢ Tab æ ·å¼
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');

        // åˆ‡æ¢é¡µé¢æ˜¾ç¤º
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + tabName).classList.add('active');

        if(tabName === 'history') {
            renderHistory();
        }
    }

    // --- åŸºç¡€åŠŸèƒ½ (è‡ªåŠ¨ä¿å­˜/Checkbox) ---
    function autoSave() {
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            if(input.id) {
                if(input.type === 'checkbox') {
                    localStorage.setItem('current_' + input.id, input.checked);
                } else {
                    localStorage.setItem('current_' + input.id, input.value);
                }
            }
        });
    }

    function loadSavedData() {
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            if(input.id) {
                const savedValue = localStorage.getItem('current_' + input.id);
                if (savedValue !== null) {
                    if(input.type === 'checkbox') {
                        input.checked = (savedValue === 'true');
                        if(input.checked) input.closest('.checkbox-btn').classList.add('checked');
                    } else {
                        input.value = savedValue;
                    }
                }
            }
        });
    }

    function toggleCheck(element) {
        const checkbox = element.querySelector('input[type="checkbox"]');
        setTimeout(() => {
            if (checkbox.checked) {
                element.classList.add('checked');
            } else {
                element.classList.remove('checked');
            }
            autoSave();
        }, 50);
    }

    function clearData() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºä»Šæ—¥å†…å®¹å—ï¼Ÿ")) {
            // æ¸…é™¤ä»¥ current_ å¼€å¤´çš„ localStorage
            Object.keys(localStorage).forEach(key => {
                if(key.startsWith('current_')) localStorage.removeItem(key);
            });
            location.reload();
        }
    }

    // --- æ ¸å¿ƒé€»è¾‘ï¼šç”ŸæˆæŠ¥å‘Šæ–‡æœ¬ ---
    function generateReportText() {
        const date = document.getElementById('currentDate').textContent;
        const status = document.getElementById('energyStatus').value;
        const getVal = (id) => document.getElementById(id).value || "æœªå¡«å†™";
        const getCheck = (id) => document.getElementById(id).checked ? "âœ…" : "â­•ï¸";
        
        // è·å–åŠ¨æ€æ—¶é—´
        const times = {};
        for(let i=1; i<=7; i++) times[i] = document.getElementById('time_0'+i).value;

        let report = `ğŸ“… ${date}\nğŸ”‹ ${status}\n\n`;
        report += `--- â˜€ï¸ ä¸Šåˆ ---\n`;
        report += `${times[1]} ğŸŒ±: ${getCheck('check_water_am')}æ°´ | ğŸ¥£ ${getVal('input_breakfast')}\n`;
        report += `${times[2]} ğŸ”¥: ${getVal('input_top1_task')}\n`;
        report += `      â””â”€ ä¸“æ³¨${getCheck('check_focus_90')} | è¡¥ç»™${getCheck('check_drink_supply')}\n`;
        report += `${times[3]} ğŸ”„: ğŸš¶ ${getVal('input_rest_activity')} | ğŸ“š ${getVal('input_task_2')}\n\n`;
        report += `--- ğŸŒ¤ ä¸­åˆ ---\n`;
        report += `${times[4]} ğŸ§˜â€â™€ï¸: ğŸ¥— ${getVal('input_lunch')} | ğŸ˜´ ${getCheck('check_nap')}\n\n`;
        report += `--- ğŸŒ¥ ä¸‹åˆ ---\n`;
        report += `${times[5]} âš–ï¸: ${document.getElementById('afternoon_mode').value}\n`;
        report += `ğŸ“: ${document.getElementById('input_pm_tasks').value.replace(/\n/g, ' ')}\n`;
        report += `ğŸ: ${getCheck('check_snack')}\n\n`;
        report += `--- ğŸŒ™ æ™šé—´ ---\n`;
        report += `${times[6]} ğŸƒ: ${getVal('input_exercise')} | ğŸ² ${getVal('input_dinner')}\n`;
        report += `${times[7]} ğŸŒ™: ğŸ“µ${getCheck('check_no_phone')} | ğŸ¦¶${getCheck('check_foot_bath')} | ğŸ§ ${getVal('input_audio')}\n\n`;
        report += `ğŸ’¡ å¤ç›˜: ${getVal('input_review')}`;
        
        return report;
    }

    function generateAndCopy() {
        const report = `ğŸ“‹ **æ¯æ—¥èƒ½é‡æŠ¥å‘Š**\n` + generateReportText();
        navigator.clipboard.writeText(report).then(() => showToast("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"));
    }

    // --- å†å²è®°å½•åŠŸèƒ½ ---

    // 1. å½’æ¡£ä¿å­˜
    function archiveToday() {
        if(!confirm("ç¡®å®šè¦å½’æ¡£ä»Šå¤©çš„è®°å½•å—ï¼Ÿ\nå½’æ¡£åå¯ä»¥åœ¨â€œå†å²è®°å½•â€ä¸­æŸ¥çœ‹ã€‚")) return;

        const dateStr = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        const displayDate = document.getElementById('currentDate').textContent;
        const status = document.getElementById('energyStatus').value;
        const topTask = document.getElementById('input_top1_task').value || "æ— æ ¸å¿ƒä»»åŠ¡";
        const fullReport = generateReportText();

        // æ„å»ºæ•°æ®å¯¹è±¡
        const entry = {
            id: dateStr,
            displayDate: displayDate,
            status: status,
            topTask: topTask,
            fullReport: fullReport,
            timestamp: new Date().getTime()
        };

        // è·å–ç°æœ‰å†å²
        let history = JSON.parse(localStorage.getItem('energy_history') || "[]");
        
        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¦†ç›–
        const existingIndex = history.findIndex(h => h.id === dateStr);
        if(existingIndex > -1) {
            history[existingIndex] = entry;
        } else {
            history.push(entry);
        }

        // ä¿å­˜å› LocalStorage
        localStorage.setItem('energy_history', JSON.stringify(history));
        
        showToast("å·²å½’æ¡£ä¿å­˜ï¼");
        switchTab('history'); // è‡ªåŠ¨è·³åˆ°å†å²é¡µ
    }

    // 2. æ¸²æŸ“å†å²åˆ—è¡¨
    function renderHistory() {
        const container = document.getElementById('history-container');
        let history = JSON.parse(localStorage.getItem('energy_history') || "[]");

        if(history.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #999; margin-top: 50px;">æš‚æ— å†å²è®°å½•</p>';
            return;
        }

        // æŒ‰æ—¶é—´å€’åºæ’åº
        history.sort((a, b) => b.timestamp - a.timestamp);

        let html = '';
        let currentMonth = '';

        history.forEach(item => {
            // æå–æœˆä»½ (ä¾‹å¦‚ 2023å¹´10æœˆ)
            const itemDate = new Date(item.timestamp);
            const monthStr = itemDate.getFullYear() + "å¹´" + (itemDate.getMonth() + 1) + "æœˆ";

            // å¦‚æœæ˜¯æ–°æœˆä»½ï¼Œæ·»åŠ æ ‡é¢˜
            if(monthStr !== currentMonth) {
                html += `<div class="month-header">${monthStr}</div>`;
                currentMonth = monthStr;
            }

            // ç¡®å®šçŠ¶æ€é¢œè‰²ç±»
            let statusClass = 'status-mid';
            if(item.status.includes('æ—ºç››')) statusClass = 'status-good';
            if(item.status.includes('ç–²æƒ«')) statusClass = 'status-bad';

            html += `
                <div class="history-item ${statusClass}" onclick="showDetail('${item.id}')">
                    <div class="history-date">${item.displayDate}</div>
                    <div class="history-summary">ğŸ”¥ ${item.topTask}</div>
                    <div class="history-tags">
                        <span class="tag">${item.status}</span>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    // 3. æŸ¥çœ‹è¯¦æƒ… & åˆ é™¤
    function showDetail(id) {
        let history = JSON.parse(localStorage.getItem('energy_history') || "[]");
        const item = history.find(h => h.id === id);
        
        if(item) {
            document.getElementById('modalTitle').textContent = item.displayDate;
            document.getElementById('modalText').textContent = item.fullReport;
            
            // ç»‘å®šåˆ é™¤äº‹ä»¶
            const deleteBtn = document.getElementById('deleteBtn');
            deleteBtn.onclick = function() {
                if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")) {
                    history = history.filter(h => h.id !== id);
                    localStorage.setItem('energy_history', JSON.stringify(history));
                    closeModal(null, true);
                    renderHistory();
                    showToast("è®°å½•å·²åˆ é™¤");
                }
            };

            document.getElementById('detailModal').style.display = 'flex';
        }
    }

    function closeModal(e, force) {
        if (force || e.target.className === 'modal-overlay') {
            document.getElementById('detailModal').style.display = 'none';
        }
    }

    function showToast(msg) {
        const x = document.getElementById("toast");
        x.textContent = msg;
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
    }
</script>

</body>
</html>
